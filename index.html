<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE NEW COLLEGE - Live Attendance System</title>
    <style>
        /* All your existing CSS stays exactly the same */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #8B0000 0%, #B22222 100%); min-height: 100vh; color: #333; }
        .login-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .login-card { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 100%; max-width: 450px; padding: 40px; animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .login-header { text-align: center; margin-bottom: 30px; }
        .college-logo { width: 120px; height: 120px; margin: 0 auto 20px; border-radius: 50%; overflow: hidden; box-shadow: 0 10px 30px rgba(139,0,0,0.3); border: 3px solid #8B0000; background: white; display: flex; align-items: center; justify-content: center; }
        .college-name { color: #8B0000; font-size: 28px; margin-bottom: 5px; font-weight: 700; }
        .college-tagline { color: #B22222; font-size: 18px; font-style: italic; margin-bottom: 10px; }
        .arabic-text { color: #8B0000; font-size: 24px; margin-bottom: 20px; font-family: 'Traditional Arabic', serif; border-top: 2px solid #8B0000; border-bottom: 2px solid #8B0000; padding: 10px; background: #FFF0F0; }
        .role-selector { display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; }
        .role-btn { padding: 10px 20px; border: 2px solid #e0e0e0; background: white; border-radius: 10px; cursor: pointer; font-size: 16px; transition: all 0.3s ease; }
        .role-btn.active { background: #8B0000; color: white; border-color: #8B0000; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; color: #555; font-weight: 500; }
        .input-group input { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 16px; transition: all 0.3s ease; }
        .input-group input:focus { outline: none; border-color: #8B0000; box-shadow: 0 0 0 3px rgba(139,0,0,0.1); }
        .login-btn { width: 100%; padding: 14px; background: linear-gradient(135deg, #8B0000 0%, #B22222 100%); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.3s ease; }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(139,0,0,0.3); }
        .dashboard { display: none; min-height: 100vh; background: #f5f5f5; }
        .dashboard.active { display: block; }
        .navbar { background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; position: fixed; width: 100%; top: 0; z-index: 1000; }
        .nav-left { display: flex; align-items: center; gap: 15px; }
        .back-btn-nav { background: none; border: none; font-size: 24px; cursor: pointer; color: #8B0000; display: none; transition: transform 0.2s ease; }
        .back-btn-nav.visible { display: block; }
        .nav-brand { display: flex; align-items: center; gap: 10px; }
        .nav-logo { width: 40px; height: 40px; border-radius: 50%; overflow: hidden; border: 2px solid #8B0000; background: white; display: flex; align-items: center; justify-content: center; }
        .nav-brand h2 { color: #8B0000; font-size: 18px; }
        .nav-right { display: flex; align-items: center; gap: 15px; }
        .refresh-btn { background: none; border: none; font-size: 20px; cursor: pointer; color: #8B0000; transition: transform 0.5s ease; }
        .refresh-btn:hover { transform: rotate(180deg); }
        .menu-toggle { font-size: 24px; cursor: pointer; color: #8B0000; }
        .main-content { margin-top: 60px; margin-bottom: 70px; padding: 20px; min-height: calc(100vh - 130px); overflow-y: auto; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 5px; color: #666; font-size: 12px; cursor: pointer; transition: all 0.3s ease; flex: 1; padding: 5px; }
        .nav-item.active { color: #8B0000; }
        .menu-full { position: fixed; top: 60px; left: 0; width: 100%; height: calc(100vh - 130px); background: white; z-index: 999; overflow-y: auto; padding: 20px; display: none; }
        .menu-full.open { display: block; }
        .menu-full .search-box { margin-bottom: 20px; }
        .menu-full .search-box input { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 25px; font-size: 14px; }
        .menu-section { margin-bottom: 25px; }
        .menu-section h3 { color: #8B0000; font-size: 16px; margin-bottom: 10px; }
        .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .menu-grid-item { background: #f8f9fa; padding: 15px; border-radius: 10px; display: flex; align-items: center; gap: 10px; cursor: pointer; transition: all 0.3s ease; }
        .menu-grid-item:hover { background: #f0f0f0; transform: translateY(-2px); }
        .recent-section { margin-bottom: 20px; }
        .recent-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .clear-all { color: #8B0000; font-size: 13px; cursor: pointer; }
        .recent-item { display: flex; align-items: center; gap: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px; margin-bottom: 8px; cursor: pointer; }
        .student-home { max-width: 600px; margin: 0 auto; display: flex; flex-direction: column; gap: 20px; }
        .student-header { margin-bottom: 5px; }
        .student-header h1 { color: #333; font-size: 22px; margin-bottom: 5px; }
        .student-header p { color: #666; font-size: 14px; }
        .hours-grid { display: flex; gap: 15px; margin-bottom: 20px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .hour-box { flex: 1; padding: 15px; background: #f8f9fa; border-radius: 10px; text-align: center; border: 2px solid transparent; transition: all 0.3s ease; cursor: pointer; }
        .hour-box.present { background: #d4edda; border-color: #28a745; }
        .hour-box.absent { background: #f8d7da; border-color: #dc3545; }
        .hour-box.late { background: #fff3cd; border-color: #ffc107; }
        .hour-box.letoff { background: #cce5ff; border-color: #004085; }
        .hour-box .hour { color: #333; font-size: 14px; margin-bottom: 5px; font-weight: 600; }
        .hour-box .status { font-size: 12px; font-weight: 600; }
        .period-detail-card { background: white; border-radius: 15px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); animation: slideDown 0.3s ease; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .period-detail-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0; }
        .period-detail-header h3 { color: #8B0000; font-size: 18px; font-weight: 600; }
        .period-detail-header .period-time { color: #666; font-size: 14px; }
        .period-detail-content { display: flex; flex-direction: column; gap: 12px; }
        .period-detail-row { display: flex; align-items: center; gap: 15px; }
        .period-detail-label { min-width: 100px; color: #666; font-size: 14px; font-weight: 500; }
        .period-detail-value { color: #333; font-size: 15px; font-weight: 500; }
        .period-detail-value.faculty { color: #8B0000; font-weight: 600; }
        .period-detail-value.status { padding: 4px 12px; border-radius: 20px; font-size: 13px; font-weight: 600; }
        .period-detail-value.status.present { background: #d4edda; color: #28a745; }
        .period-detail-value.status.absent { background: #f8d7da; color: #dc3545; }
        .period-detail-value.status.late { background: #fff3cd; color: #856404; }
        .period-detail-value.status.letoff { background: #cce5ff; color: #004085; }
        .period-detail-course { margin-top: 10px; padding: 15px; background: #f8f9fa; border-radius: 10px; }
        .view-all-link { text-align: right; margin: 15px 0; }
        .view-all-link a { color: #8B0000; text-decoration: none; font-size: 14px; font-weight: 500; }
        .feedback-section { background: white; border-radius: 15px; padding: 20px; margin: 15px 0; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .feedback-btn { background: linear-gradient(135deg, #8B0000 0%, #B22222 100%); color: white; border: none; padding: 10px 30px; border-radius: 25px; font-size: 14px; font-weight: 600; cursor: pointer; }
        .semester-card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .card-header h3 { color: #333; font-size: 16px; font-weight: 600; }
        .see-all { color: #8B0000; text-decoration: none; font-size: 13px; }
        .semester-stats { display: flex; align-items: center; gap: 20px; margin-top: 10px; }
        .stats-details { flex: 1; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px dashed #e0e0e0; }
        .stat-label { color: #666; font-size: 13px; }
        .stat-value { color: #333; font-weight: 600; font-size: 13px; }
        .percentage-circle { width: 80px; height: 80px; background: #8B0000; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; font-weight: bold; position: relative; }
        .percentage-circle::after { content: '%'; font-size: 12px; position: absolute; top: 25px; right: 18px; }
        .attendance-page { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .attendance-tabs { display: flex; gap: 15px; margin-bottom: 20px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
        .attendance-tab { padding: 8px 20px; border: none; background: none; color: #666; font-size: 15px; font-weight: 500; cursor: pointer; border-radius: 20px; transition: all 0.3s ease; }
        .attendance-tab.active { background: #8B0000; color: white; }
        .course-list { display: flex; flex-direction: column; gap: 20px; }
        .course-item { padding: 15px; background: #f8f9fa; border-radius: 12px; }
        .course-header h3 { color: #333; font-size: 16px; font-weight: 600; margin-bottom: 5px; }
        .course-stats { display: flex; gap: 20px; font-size: 14px; }
        .course-stats span { color: #28a745; font-weight: 600; }
        .month-grid { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .month-btn { padding: 8px 15px; border: 1px solid #e0e0e0; background: white; border-radius: 20px; color: #666; font-size: 13px; cursor: pointer; transition: all 0.3s ease; }
        .month-btn.active { background: #8B0000; color: white; border-color: #8B0000; }
        .attendance-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .attendance-table th { text-align: center; padding: 10px; background: #f8f9fa; color: #666; font-size: 13px; font-weight: 600; }
        .attendance-table td { text-align: center; padding: 8px; border-bottom: 1px solid #f0f0f0; font-size: 13px; }
        .status-present { color: #28a745; font-size: 18px; }
        .status-absent { color: #dc3545; font-size: 18px; }
        .status-late { color: #ffc107; font-size: 18px; }
        .status-letoff { color: #17a2b8; font-size: 18px; }
        .status-unmarked { color: #6c757d; font-size: 18px; }
        .status-buttons { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; justify-content: center; }
        .status-btn { padding: 8px 15px; border: none; border-radius: 20px; font-size: 12px; font-weight: 500; cursor: default; }
        .status-btn.present { background: #d4edda; color: #28a745; }
        .status-btn.absent { background: #f8d7da; color: #dc3545; }
        .status-btn.late { background: #fff3cd; color: #856404; }
        .status-btn.letoff { background: #cce5ff; color: #004085; }
        .status-btn.unmarked { background: #e2e3e5; color: #383d41; }
        .term-stats { margin-top: 20px; }
        .term-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .term-header h3 { color: #333; font-size: 18px; }
        .term-header span { color: #8B0000; font-size: 24px; font-weight: bold; }
        .term-period { background: #f8f9fa; padding: 10px; border-radius: 8px; text-align: center; margin-bottom: 20px; color: #666; }
        .term-table { width: 100%; border-collapse: collapse; }
        .term-table th { text-align: left; padding: 10px; background: #f8f9fa; color: #666; font-size: 13px; font-weight: 600; }
        .term-table td { padding: 10px; border-bottom: 1px solid #f0f0f0; font-size: 13px; }
        .term-table tr:last-child td { border-bottom: none; background: #f8f9fa; font-weight: 600; }
        .mark-attendance-page { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 800px; margin: 0 auto; }
        .period-grid { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px; }
        .period-card { flex: 1; min-width: 100px; padding: 20px; background: #f8f9fa; border-radius: 12px; text-align: center; cursor: pointer; border: 2px solid transparent; transition: all 0.3s ease; }
        .period-card.selected { border-color: #8B0000; background: #fff0f0; transform: translateY(-2px); }
        .course-select { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 14px; margin-bottom: 20px; }
        .student-list { max-height: 500px; overflow-y: auto; }
        .student-list-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 10px; margin-bottom: 10px; }
        .student-status { display: flex; gap: 8px; }
        .status-option { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; font-size: 18px; background: white; border: 2px solid #e0e0e0; }
        .status-option.present.active { background: #d4edda; border-color: #28a745; color: #28a745; }
        .status-option.absent.active { background: #f8d7da; border-color: #dc3545; color: #dc3545; }
        .status-option.late.active { background: #fff3cd; border-color: #ffc107; color: #856404; }
        .status-option.letoff.active { background: #cce5ff; border-color: #004085; color: #004085; }
        .submit-btn { padding: 12px 30px; background: #8B0000; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .notification { position: fixed; top: 80px; right: 20px; padding: 12px 20px; background: white; border-radius: 8px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); display: none; align-items: center; gap: 10px; z-index: 1500; border-left: 4px solid #8B0000; }
        .notification.show { display: flex; }
        .notification.success { border-left-color: #28a745; }
        .notification.error { border-left-color: #dc3545; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 9999; color: white; }
        .loading-overlay.active { display: flex; }
        .loading-spinner { width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #8B0000; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div>Loading data...</div>
    </div>

    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="college-logo">
                    <img src="TNC.png" alt="THE NEW COLLEGE Logo" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MCIgaGVpZ2h0PSI4MCIgdmlld0JveD0iMCAwIDgwIDgwIj48cmVjdCB3aWR0aD0iODAiIGhlaWdodD0iODAiIGZpbGw9IiM4QjAwMDAiLz48dGV4dCB4PSI0MCIgeT0iNDAiIGZvbnQtc2l6ZT0iMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiPlROQzwvdGV4dD48L3N2Zz4=';">
                </div>
                <h1 class="college-name">THE NEW COLLEGE</h1>
                <div class="college-tagline">Empowering Education, Enriching Lives</div>
                <div class="arabic-text">
                    ÿ±Ÿéÿ®ŸêŸë ÿ≤ÿØŸíŸÜŸêŸä ÿπŸêŸÑŸíŸÖÿßŸã
                    <br>
                    <small>"MY LORD! INCREASE ME IN KNOWLEDGE"</small>
                </div>
            </div>
            
            <div class="role-selector">
                <button class="role-btn active" onclick="setRole('student')">Student</button>
                <button class="role-btn" onclick="setRole('staff')">Staff</button>
                <button class="role-btn" onclick="setRole('admin')">Admin</button>
            </div>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div id="studentFields">
                    <div class="input-group">
                        <label>üìã Register Number</label>
                        <input type="text" id="registerNumber" placeholder="Enter register number">
                    </div>
                    <div class="input-group">
                        <label>üîí Password</label>
                        <input type="password" id="password" placeholder="Enter password">
                        <div class="hint">Password is your register number</div>
                    </div>
                </div>

                <div id="staffAdminFields" style="display: none;">
                    <div class="input-group">
                        <label>üìß Email Address</label>
                        <input type="email" id="email" placeholder="Enter email" value="sa.abdulkadhar@thenewcollege.edu.in">
                    </div>
                    <div class="input-group">
                        <label>üîí Password</label>
                        <input type="password" id="adminPassword" placeholder="Enter password" value="staff">
                    </div>
                </div>

                <button type="submit" class="login-btn">Login to Dashboard</button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <nav class="navbar">
            <div class="nav-left">
                <button class="back-btn-nav" id="backBtnNav" onclick="goBack()">‚Üê</button>
                <div class="nav-brand">
                    <div class="nav-logo">
                        <img src="TNC.png" alt="TNC" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgdmlld0JveD0iMCAwIDQwIDQwIj48cmVjdCB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIGZpbGw9IiM4QjAwMDAiLz48dGV4dCB4PSIyMCIgeT0iMjAiIGZvbnQtc2l6ZT0iMTIiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiPlROQzwvdGV4dD48L3N2Zz4=';">
                    </div>
                    <div>
                        <h2>THE NEW COLLEGE</h2>
                        <small>Est. 1951 | Chennai</small>
                    </div>
                </div>
            </div>
            <div class="nav-right">
                <button class="refresh-btn" onclick="refreshData()" title="Refresh data">‚Üª</button>
                <div class="menu-toggle" onclick="toggleMenu()">‚ò∞</div>
            </div>
        </nav>

        <!-- Full Page Menu -->
        <div class="menu-full" id="fullMenu">
            <div class="search-box">
                <input type="text" placeholder="Search" id="menuSearch" onkeyup="searchMenu(this.value)">
            </div>
            <div class="recent-section" id="recentSection">
                <div class="recent-header">
                    <h3>Recent</h3>
                    <span class="clear-all" onclick="clearRecent()">Clear all</span>
                </div>
                <div id="recentItems"></div>
            </div>
            <div class="menu-section">
                <h3>Menu</h3>
                <div class="menu-grid" id="menuGrid"></div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent"></div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchTab('home')">
                <span>üè†</span>
                <span>Home</span>
            </div>
            <div class="nav-item" onclick="switchTab('menu')">
                <span>üìã</span>
                <span>Menu</span>
            </div>
            <div class="nav-item" onclick="switchTab('profile')">
                <span>üë§</span>
                <span>Profile</span>
            </div>
        </div>

        <!-- College Footer -->
        <div class="college-footer">
            <div class="arabic-footer">ÿ±Ÿéÿ®ŸêŸë ÿ≤ÿØŸíŸÜŸêŸä ÿπŸêŸÑŸíŸÖÿßŸã</div>
            <div>THE NEW COLLEGE | Established 1951 | Affiliated to University of Madras</div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <span id="notificationIcon">‚ÑπÔ∏è</span>
        <span id="notificationMessage"></span>
    </div>

    <script>
        // ==================== NETLIFY CONFIGURATION ====================
        const NETLIFY_URL = 'https://thenewcollegeattendance.netlify.app';
        
        const API = {
            saveAttendance: `${NETLIFY_URL}/.netlify/functions/save-attendance`,
            getStudents: `${NETLIFY_URL}/.netlify/functions/get-students`,
            getAttendance: `${NETLIFY_URL}/.netlify/functions/get-attendance`
        };

        // ==================== APPLICATION STATE ====================
        let currentUser = null;
        let currentRole = 'student';
        let currentTab = 'home';
        let menuOpen = false;
        let recentItems = ['Library Go', 'Attendance'];
        let selectedPeriod = 1;
        let selectedCourse = null;
        let attendanceData = {};
        let expandedPeriod = null;
        let studentsList = [];
        
        // Navigation History
        let navigationHistory = [];
        let currentPage = 'home';

        // Auto-refresh interval
        let refreshInterval = null;

        // For hourly view
        let selectedMonth = 'November';
        let selectedYear = 2025;

        // ==================== STAFF MEMBERS ====================
        const staffMembers = [
            { name: 'Dr. P. Hakkim Divan Mydeen', email: 'p.hakkimdivanmydeen@thenewcollege.edu.in', password: 'staff', department: 'Computer Science', designation: 'Professor' },
            { name: 'Mr. S.A. Abdul Kadhar', email: 'sa.abdulkadhar@thenewcollege.edu.in', password: 'staff', department: 'Computer Science', designation: 'Assistant Professor' }
        ];

        // ==================== COURSES ====================
        const courses = [
            { id: 1, code: '20BJM608', name: 'Programming in ASP.NET', faculty: 'M M Syed Sulaiman', totalHours: 50 },
            { id: 2, code: '20BJM609', name: 'Operating Systems', faculty: 'N Anver Hussain', totalHours: 57 },
            { id: 3, code: '20BJMP607', name: 'Programming in ASP.NET PRACTICAL ‚Äì VII', faculty: 'Dr. S. SAKTHIVEL', totalHours: 65 },
            { id: 4, code: '20BJM610', name: 'Internet of Things', faculty: 'Dr. G NAJEEB AHMED', totalHours: 37 },
            { id: 5, code: '20BJMQ601', name: 'Mini Project', faculty: 'Dr. J. Abdul Rasheedh', totalHours: 35 }
        ];

        // ==================== ADMIN USER ====================
        const adminUser = {
            email: 'admin@thenewcollege.in',
            password: 'admin',
            name: 'Administrator'
        };

        // ==================== LOAD STUDENTS FROM NETLIFY FUNCTION ====================
        async function loadStudentsFromSheet() {
            try {
                showLoading();
                console.log('üîç Fetching students from:', API.getStudents);
                
                const response = await fetch(API.getStudents);
                const data = await response.json();
                
                console.log('üì• Students response:', data);
                
                if (data.error) {
                    console.error('Error:', data.error);
                    showNotification(`Error: ${data.error}`, 'error');
                    return [];
                }
                
                if (data.students && Array.isArray(data.students)) {
                    studentsList = data.students;
                    localStorage.setItem('students', JSON.stringify(studentsList));
                    console.log(`‚úÖ Loaded ${studentsList.length} students`);
                    
                    if (currentRole !== 'student' && currentPage === 'home') {
                        showStaffDashboard();
                    }
                    
                    return studentsList;
                } else {
                    console.log('‚ö†Ô∏è No students found');
                    studentsList = [];
                    return [];
                }
            } catch (error) {
                console.error('Error loading students:', error);
                showNotification('Error connecting to server', 'error');
                return [];
            } finally {
                hideLoading();
            }
        }

        // ==================== LOAD ATTENDANCE FROM NETLIFY FUNCTION ====================
        async function loadAttendanceFromSheet() {
            try {
                const url = API.getAttendance + '?t=' + new Date().getTime();
                console.log('Fetching attendance from:', url);
                
                const response = await fetch(url);
                const data = await response.json();
                
                console.log('Attendance data received:', data);
                
                if (data.records) {
                    attendanceData = data.records;
                    localStorage.setItem('attendanceRecords', JSON.stringify(attendanceData));
                    console.log('Loaded attendance records:', Object.keys(attendanceData).filter(key => !key.includes('_')).length);
                    
                    if (currentRole === 'student') {
                        if (currentPage === 'attendance') showAttendance();
                        else if (currentPage === 'home') showStudentHome();
                    }
                }
            } catch (error) {
                console.error('Error loading attendance:', error);
                const saved = localStorage.getItem('attendanceRecords');
                if (saved) {
                    attendanceData = JSON.parse(saved);
                }
            }
        }

        // ==================== SAVE ATTENDANCE TO NETLIFY FUNCTION ====================
        async function saveAttendanceToSheet(records) {
            showLoading();
            try {
                console.log('Saving to Google Sheets via Netlify:', records);
                
                const response = await fetch(API.saveAttendance, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ records })
                });
                
                const result = await response.json();
                console.log('Save result:', result);
                
                if (result.error) {
                    throw new Error(result.error);
                }
                
                if (result.success) {
                    // Update local data
                    records.forEach(record => {
                        const key = `${record.studentId}_${record.date}_${record.period}`;
                        attendanceData[key] = record.status;
                        attendanceData[key + '_faculty'] = record.faculty;
                        attendanceData[key + '_course'] = record.course;
                        attendanceData[key + '_studentName'] = record.studentName;
                    });
                    
                    localStorage.setItem('attendanceRecords', JSON.stringify(attendanceData));
                    showNotification(`‚úÖ Saved ${records.length} records to Google Sheets!`, 'success');
                    
                    // Refresh data for all students
                    setTimeout(async () => {
                        await loadAttendanceFromSheet();
                    }, 1000);
                }
                
            } catch (error) {
                console.error('Error saving:', error);
                showNotification('‚ùå Failed to save to Google Sheets', 'error');
            } finally {
                hideLoading();
            }
        }

        // ==================== TEST NETLIFY CONNECTION ====================
async function testConnection() {
    showLoading();
    try {
        const response = await fetch(API.getStudents);
        const data = await response.json();
        
        if (data.students) {
            alert(`‚úÖ Connected to Netlify!\n\nStudents loaded: ${data.students.length}`);
        } else {
            alert('‚ö†Ô∏è Connected but no students found');
        }
    } catch (error) {
        alert('‚ùå Connection failed: ' + error);
    } finally {
        hideLoading();
    }
}

// ============ ADD ALL THESE NEW FUNCTIONS AFTER testConnection ============

// ==================== EXPORT ATTENDANCE DATA ====================
async function exportAttendance() {
    showLoading();
    try {
        // Get all attendance data
        const records = [];
        
        // Convert attendanceData to array format
        Object.keys(attendanceData).forEach(key => {
            if (!key.includes('_faculty') && !key.includes('_course') && !key.includes('_studentName') && !key.includes('_timestamp')) {
                const [studentId, date, period] = key.split('_');
                records.push({
                    date: date,
                    studentId: studentId,
                    studentName: attendanceData[key + '_studentName'] || '',
                    period: period,
                    status: attendanceData[key],
                    faculty: attendanceData[key + '_faculty'] || '',
                    course: attendanceData[key + '_course'] || '',
                    timestamp: attendanceData[key + '_timestamp'] || ''
                });
            }
        });

        // Convert to CSV
        const csv = convertToCSV(records);
        
        // Download file
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `attendance_export_${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        showNotification(`‚úÖ Exported ${records.length} records`, 'success');
        
    } catch (error) {
        console.error('Export error:', error);
        showNotification('‚ùå Export failed', 'error');
    } finally {
        hideLoading();
    }
}

// ==================== IMPORT ATTENDANCE DATA ====================
function importAttendance() {
    // Create file input
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.csv,.xlsx,.xls';
    
    input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        showLoading();
        
        try {
            const reader = new FileReader();
            
            reader.onload = async (event) => {
                try {
                    const csvData = event.target.result;
                    const records = parseCSV(csvData);
                    
                    if (records.length === 0) {
                        showNotification('‚ùå No valid records found', 'error');
                        hideLoading();
                        return;
                    }
                    
                    // Show preview and confirm
                    if (confirm(`Found ${records.length} records. Import to Google Sheets?`)) {
                        await saveBulkAttendance(records);
                    }
                    
                } catch (parseError) {
                    console.error('Parse error:', parseError);
                    showNotification('‚ùå Invalid file format', 'error');
                    hideLoading();
                }
            };
            
            reader.readAsText(file);
            
        } catch (error) {
            console.error('Import error:', error);
            showNotification('‚ùå Import failed', 'error');
            hideLoading();
        }
    };
    
    input.click();
}

// ==================== CONVERT TO CSV ====================
function convertToCSV(data) {
    if (data.length === 0) return '';
    
    const headers = ['Date', 'StudentID', 'StudentName', 'Period', 'Status', 'Faculty', 'Course', 'Timestamp'];
    const csvRows = [];
    
    // Add headers
    csvRows.push(headers.join(','));
    
    // Add data rows
    data.forEach(row => {
        const values = headers.map(header => {
            const value = row[header.toLowerCase()] || '';
            return `"${value.toString().replace(/"/g, '""')}"`; // Escape quotes
        });
        csvRows.push(values.join(','));
    });
    
    return csvRows.join('\n');
}

// ==================== PARSE CSV ====================
function parseCSV(csvText) {
    const lines = csvText.split('\n');
    if (lines.length < 2) return [];
    
    const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim().toLowerCase());
    const records = [];
    
    for (let i = 1; i < lines.length; i++) {
        if (!lines[i].trim()) continue;
        
        // Simple CSV parsing (works for basic CSVs)
        const values = lines[i].split(',').map(v => v.replace(/"/g, '').trim());
        const record = {};
        
        headers.forEach((header, index) => {
            if (values[index]) {
                record[header] = values[index];
            }
        });
        
        // Validate required fields
        if (record.date && record.studentid && record.status) {
            records.push({
                date: record.date,
                studentId: record.studentid,
                studentName: record.studentname || '',
                period: record.period || '1',
                status: record.status,
                faculty: record.faculty || 'System Import',
                course: record.course || 'Imported'
            });
        }
    }
    
    return records;
}

// ==================== SAVE BULK ATTENDANCE ====================
async function saveBulkAttendance(records) {
    showLoading();
    try {
        const response = await fetch(API.saveAttendance, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ records })
        });
        
        const result = await response.json();
        
        if (result.error) {
            throw new Error(result.error);
        }
        
        if (result.success) {
            // Update local data
            records.forEach(record => {
                const key = `${record.studentId}_${record.date}_${record.period}`;
                attendanceData[key] = record.status;
                attendanceData[key + '_faculty'] = record.faculty;
                attendanceData[key + '_course'] = record.course;
                attendanceData[key + '_studentName'] = record.studentName;
            });
            
            localStorage.setItem('attendanceRecords', JSON.stringify(attendanceData));
            showNotification(`‚úÖ Imported ${records.length} records!`, 'success');
            
            // Refresh data
            setTimeout(async () => {
                await loadAttendanceFromSheet();
            }, 1000);
        }
        
    } catch (error) {
        console.error('Bulk save error:', error);
        showNotification('‚ùå Import failed', 'error');
    } finally {
        hideLoading();
    }
}

// ==================== EXPORT STUDENT LIST ====================
function exportStudents() {
    if (studentsList.length === 0) {
        showNotification('No students to export', 'info');
        return;
    }
    
    const csv = convertToCSV(studentsList);
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `students_export_${new Date().toISOString().split('T')[0]}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
    
    showNotification(`‚úÖ Exported ${studentsList.length} students`, 'success');
}

        // ==================== SESSION MANAGEMENT ====================
        function loadSession() {
            const savedUser = localStorage.getItem('currentUser');
            const savedRole = localStorage.getItem('currentRole');
            const savedStudents = localStorage.getItem('students');
            const savedAttendance = localStorage.getItem('attendanceRecords');
            
            if (savedStudents) studentsList = JSON.parse(savedStudents);
            if (savedAttendance) attendanceData = JSON.parse(savedAttendance);
            
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                currentRole = savedRole || 'student';
                
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('dashboard').classList.add('active');
                
                updateMenuForRole();
                
                if (currentRole === 'student') showStudentHome();
                else showStaffDashboard();
            }
        }

        function saveSession() {
            if (currentUser) {
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                localStorage.setItem('currentRole', currentRole);
            }
        }

        function clearSession() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('currentRole');
            currentUser = null;
        }

        // ==================== AUTO-REFRESH ====================
        function startAutoRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            refreshInterval = setInterval(() => {
                if (currentUser && currentRole === 'student') {
                    loadAttendanceFromSheet();
                }
            }, 10000);
        }

        async function refreshData() {
            showLoading();
            await loadAttendanceFromSheet();
            await loadStudentsFromSheet();
            hideLoading();
            showNotification('Data refreshed!', 'success');
            
            if (currentRole === 'student') {
                if (currentPage === 'home') showStudentHome();
                else if (currentPage === 'attendance') showAttendance();
            } else {
                showStaffDashboard();
            }
        }

        // ==================== LOGIN HANDLER ====================
        function setRole(role) {
            currentRole = role;
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.getElementById('studentFields').style.display = role === 'student' ? 'block' : 'none';
            document.getElementById('staffAdminFields').style.display = role !== 'student' ? 'block' : 'none';
        }

        async function handleLogin(event) {
            event.preventDefault();
            
            if (currentRole === 'student') {
                const regNo = document.getElementById('registerNumber').value.trim();
                const password = document.getElementById('password').value.trim();

                showLoading();
                
                try {
                    const students = await loadStudentsFromSheet();
                    
                    const student = students.find(s => 
                        s.reg == regNo && (s.password == password || s.password == regNo)
                    );
                    
                    if (student) {
                        currentUser = {
                            reg: student.reg,
                            name: student.name,
                            role: 'student',
                            department: 'Computer Science',
                            semester: student.year || '1st',
                            batch: student.batch || 'A'
                        };
                        
                        saveSession();
                        
                        document.getElementById('loginPage').style.display = 'none';
                        document.getElementById('dashboard').classList.add('active');
                        
                        updateMenuForRole();
                        
                        navigationHistory = [];
                        currentPage = 'home';
                        
                        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                        document.querySelector('.nav-item[onclick*="home"]').classList.add('active');
                        
                        showNotification(`Welcome, ${student.name}!`, 'success');
                        showStudentHome();
                    } else {
                        showNotification('Invalid Register Number or Password!', 'error');
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    showNotification('Error connecting to server', 'error');
                } finally {
                    hideLoading();
                }
            } else if (currentRole === 'staff') {
                const email = document.getElementById('email').value;
                const password = document.getElementById('adminPassword').value;

                const staff = staffMembers.find(s => s.email === email && s.password === password);

                if (staff) {
                    currentUser = { ...staff, role: 'staff' };
                    saveSession();
                    
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('dashboard').classList.add('active');
                    
                    await loadStudentsFromSheet();
                    await loadAttendanceFromSheet();
                    
                    updateMenuForRole();
                    showStaffDashboard();
                    
                    showNotification(`Welcome, ${staff.name}!`, 'success');
                } else {
                    showNotification('Invalid email or password!', 'error');
                }
            } else if (currentRole === 'admin') {
                const email = document.getElementById('email').value;
                const password = document.getElementById('adminPassword').value;

                if (email === adminUser.email && password === adminUser.password) {
                    currentUser = { ...adminUser, role: 'admin' };
                    saveSession();
                    
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('dashboard').classList.add('active');
                    
                    await loadStudentsFromSheet();
                    await loadAttendanceFromSheet();
                    
                    updateMenuForRole();
                    showStaffDashboard();
                    
                    showNotification('Welcome, Admin!', 'success');
                } else {
                    showNotification('Invalid admin credentials!', 'error');
                }
            }
        }

        // ==================== MENU FUNCTIONS ====================
        function updateMenuForRole() {
            const menuGrid = document.getElementById('menuGrid');
            
            if (currentRole === 'student') {
                menuGrid.innerHTML = `
                    <div class="menu-grid-item" onclick="navigateTo('libraryGo')">
                        <span>üìö</span>
                        <span>Library Go</span>
                    </div>
                    <div class="menu-grid-item" onclick="navigateTo('attendance')">
                        <span>‚úÖ</span>
                        <span>Attendance</span>
                    </div>
                    <div class="menu-grid-item" onclick="navigateTo('fees')">
                        <span>üí∞</span>
                        <span>Fees</span>
                    </div>
                    <div class="menu-grid-item" onclick="navigateTo('myAccount')">
                        <span>üë§</span>
                        <span>My Account</span>
                    </div>
                    <div class="menu-grid-item" onclick="navigateTo('tutorials')">
                        <span>üìπ</span>
                        <span>Tutorials</span>
                    </div>
                `;
            } else {
                menuGrid.innerHTML = `
                    <div class="menu-grid-item" onclick="navigateTo('markAttendance')">
                        <span>‚úÖ</span>
                        <span>Mark Attendance</span>
                    </div>
                    <div class="menu-grid-item" onclick="navigateTo('departments')">
                        <span>üèõÔ∏è</span>
                        <span>Departments</span>
                    </div>
                    <div class="menu-grid-item" onclick="navigateTo('courses')">
                        <span>üìö</span>
                        <span>All Courses</span>
                    </div>
                    <div class="menu-grid-item" onclick="navigateTo('students')">
                        <span>üë•</span>
                        <span>Students List</span>
                    </div>
                    <div class="menu-grid-item" onclick="navigateTo('faculty')">
                        <span>üë®‚Äçüè´</span>
                        <span>Faculty List</span>
                    </div>
                    <div class="menu-grid-item" onclick="testConnection()">
                        <span>üîå</span>
                        <span>Test Netlify</span>
                    </div>
                `;
            }
        }

        function navigateTo(section) {
            document.getElementById('fullMenu').classList.remove('open');
            document.getElementById('mainContent').style.display = 'block';
            
            switch(section) {
                case 'markAttendance':
                    currentPage = 'markAttendance';
                    showMarkAttendance();
                    break;
                case 'attendance':
                    currentPage = 'attendance';
                    showAttendance();
                    break;
                case 'myAccount':
                    currentPage = 'myAccount';
                    showProfile();
                    break;
                case 'departments':
                    currentPage = 'departments';
                    showDepartments();
                    break;
                case 'courses':
                    currentPage = 'courses';
                    showAllCourses();
                    break;
                case 'students':
                    currentPage = 'students';
                    showStudentsList();
                    break;
                case 'faculty':
                    currentPage = 'faculty';
                    showFacultyList();
                    break;
                case 'libraryGo':
                case 'fees':
                case 'tutorials':
                    currentPage = section;
                    showPlaceholder(section);
                    break;
                default:
                    currentPage = section;
                    showPlaceholder(section);
            }
            
            document.getElementById('backBtnNav').classList.add('visible');
        }

        function switchTab(tab) {
            currentTab = tab;
            
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.nav-item').classList.add('active');

            if (tab === 'home') {
                document.getElementById('fullMenu').classList.remove('open');
                document.getElementById('mainContent').style.display = 'block';
                
                navigationHistory = [];
                currentPage = 'home';
                expandedPeriod = null;
                document.getElementById('backBtnNav').classList.remove('visible');
                
                if (currentUser?.role === 'student') showStudentHome();
                else showStaffDashboard();
            } else if (tab === 'menu') {
                toggleMenu();
            } else if (tab === 'profile') {
                document.getElementById('fullMenu').classList.remove('open');
                document.getElementById('mainContent').style.display = 'block';
                currentPage = 'myAccount';
                showProfile();
                document.getElementById('backBtnNav').classList.add('visible');
            }
        }

        function toggleMenu() {
            menuOpen = !menuOpen;
            document.getElementById('fullMenu').classList.toggle('open', menuOpen);
            document.getElementById('mainContent').style.display = menuOpen ? 'none' : 'block';
        }

        function goBack() {
            if (currentPage === 'home') return;
            
            if (currentRole === 'student') {
                showStudentHome();
                currentPage = 'home';
                document.getElementById('backBtnNav').classList.remove('visible');
            } else {
                showStaffDashboard();
                currentPage = 'home';
                document.getElementById('backBtnNav').classList.remove('visible');
            }
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function searchMenu(query) {
            const items = document.querySelectorAll('.menu-grid-item');
            items.forEach(item => {
                const text = item.querySelector('span:last-child').textContent.toLowerCase();
                if (text.includes(query.toLowerCase())) item.style.display = 'flex';
                else item.style.display = 'none';
            });
        }

        function clearRecent() {
            recentItems = [];
            updateRecentItems();
        }

        function updateRecentItems() {
            const recentDiv = document.getElementById('recentItems');
            if (recentItems.length === 0) {
                recentDiv.innerHTML = '<div class="recent-item">No recent items</div>';
            } else {
                recentDiv.innerHTML = recentItems.map(item => {
                    const section = item.toLowerCase().replace(/ /g, '');
                    return `<div class="recent-item" onclick="navigateTo('${section}')">
                        <span>${getIconForItem(item)}</span>
                        <span>${item}</span>
                    </div>`;
                }).join('');
            }
        }

        function getIconForItem(item) {
            const icons = {
                'Library Go': 'üìö', 'Attendance': '‚úÖ', 'Fees': 'üí∞',
                'My Account': 'üë§', 'Tutorials': 'üìπ', 'Departments': 'üèõÔ∏è',
                'All Courses': 'üìö', 'Students List': 'üë•', 'Faculty List': 'üë®‚Äçüè´'
            };
            return icons[item] || 'üìå';
        }

        // ==================== STUDENT HOME PAGE ====================
        function showStudentHome() {
            const content = document.getElementById('mainContent');
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            const dayName = today.toLocaleDateString('en-US', { weekday: 'long' });
            const month = today.toLocaleDateString('en-US', { month: 'short' });
            const day = today.getDate();
            
            const studentId = currentUser.reg;
            const todayAttendance = [];
            const periodDetails = {};
            
            for (let hour = 1; hour <= 5; hour++) {
                const key = `${studentId}_${todayStr}_${hour}`;
                if (attendanceData[key]) {
                    todayAttendance.push({
                        hour: hour,
                        status: attendanceData[key],
                        faculty: attendanceData[key + '_faculty'] || 'Not assigned',
                        course: attendanceData[key + '_course'] || 'No course'
                    });
                    periodDetails[hour] = {
                        status: attendanceData[key],
                        faculty: attendanceData[key + '_faculty'] || 'Not assigned',
                        course: attendanceData[key + '_course'] || 'No course'
                    };
                } else {
                    periodDetails[hour] = { status: null };
                }
            }
            
            let hoursGridHTML = '<div class="hours-grid">';
            for (let hour = 1; hour <= 5; hour++) {
                const attendance = todayAttendance.find(a => a.hour === hour);
                const status = attendance ? attendance.status : null;
                hoursGridHTML += `
                    <div class="hour-box ${status || ''}" onclick="showPeriodDetail(${hour})">
                        <div class="hour">${hour} hr</div>
                        ${status ? `<div class="status">${getStatusText(status)}</div>` : '<div class="status">Not Marked</div>'}
                    </div>
                `;
            }
            hoursGridHTML += '</div>';
            
            let periodDetailHTML = '';
            if (expandedPeriod !== null && periodDetails[expandedPeriod]) {
                const detail = periodDetails[expandedPeriod];
                if (detail.status) {
                    periodDetailHTML = `
                        <div class="period-detail-card">
                            <div class="period-detail-header">
                                <h3>Class - Hour ${expandedPeriod}</h3>
                                <span class="period-time">${getPeriodTime(expandedPeriod)}</span>
                            </div>
                            <div class="period-detail-content">
                                <div class="period-detail-row">
                                    <span class="period-detail-label">Faculty:</span>
                                    <span class="period-detail-value faculty">${detail.faculty}</span>
                                </div>
                                <div class="period-detail-row">
                                    <span class="period-detail-label">Status:</span>
                                    <span class="period-detail-value status ${detail.status}">${getStatusText(detail.status)}</span>
                                </div>
                                <div class="period-detail-course">
                                    <h4>${detail.course}</h4>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    periodDetailHTML = `
                        <div class="period-detail-card">
                            <div class="period-detail-header">
                                <h3>Class - Hour ${expandedPeriod}</h3>
                                <span class="period-time">${getPeriodTime(expandedPeriod)}</span>
                            </div>
                            <div class="period-detail-content">
                                <p style="text-align: center; color: #666;">No attendance marked for this period</p>
                            </div>
                        </div>
                    `;
                }
            }
            
            const allStudentRecords = Object.keys(attendanceData)
                .filter(key => key.startsWith(studentId) && !key.includes('_'));
            const totalClasses = allStudentRecords.length;
            const presentClasses = allStudentRecords.filter(key => attendanceData[key] === 'present').length;
            const attendancePercentage = totalClasses > 0 ? Math.round((presentClasses / totalClasses) * 100) : 0;
            
            content.innerHTML = `
                <div class="student-home">
                    <div class="student-header">
                        <h1>${currentUser.name}</h1>
                        <p>Admission No : ${currentUser.reg}</p>
                        <p>Batch : ${currentUser.batch} | Year : ${currentUser.semester}</p>
                    </div>

                    ${hoursGridHTML}

                    ${periodDetailHTML}

                    <div class="view-all-link">
                        <a href="#" onclick="navigateTo('attendance'); return false;">View all attendance records ‚Üí</a>
                    </div>

                    <div class="feedback-section">
                        <p>Every feedback is valuable.</p>
                        <button class="feedback-btn" onclick="showNotification('Thank you for your feedback!', 'success')">Give Feedback</button>
                    </div>

                    <div class="semester-card">
                        <div class="card-header">
                            <h3>Attendance Summary</h3>
                            <a href="#" class="see-all" onclick="navigateTo('attendance'); return false;">See All ‚Üí</a>
                        </div>
                        <div>
                            <h4>Current Semester</h4>
                            <div class="semester-stats">
                                <div class="stats-details">
                                    <div class="stat-row">
                                        <span class="stat-label">Total Classes</span>
                                        <span class="stat-value">${totalClasses}</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-label">Classes Present</span>
                                        <span class="stat-value">${presentClasses}</span>
                                    </div>
                                </div>
                                <div class="percentage-circle">
                                    ${attendancePercentage}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button onclick="refreshData()" class="btn-primary" style="background: #17a2b8; padding: 10px 20px;">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>
            `;
        }

        function showPeriodDetail(hour) {
            if (expandedPeriod === hour) expandedPeriod = null;
            else expandedPeriod = hour;
            showStudentHome();
        }

        function getStatusText(status) {
            switch(status) {
                case 'present': return '‚úì Present';
                case 'absent': return '‚úó Absent';
                case 'late': return '‚è∞ Late';
                case 'letoff': return '‚òë Let-off';
                default: return '';
            }
        }

        function getPeriodTime(period) {
            const times = {
                1: '09:00 - 10:00', 2: '10:00 - 11:00',
                3: '11:00 - 12:00', 4: '12:00 - 13:00',
                5: '14:00 - 15:00'
            };
            return times[period] || '';
        }

        // ==================== STAFF DASHBOARD ====================
function showStaffDashboard() {
    const content = document.getElementById('mainContent');
    
    content.innerHTML = `
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-title">Students</div>
                <div class="stat-value">${studentsList.length}</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Staff</div>
                <div class="stat-value">${staffMembers.length}</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Courses</div>
                <div class="stat-value">${courses.length}</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Today's Date</div>
                <div class="stat-value">${new Date().toLocaleDateString()}</div>
            </div>
        </div>

        <!-- Import/Export Section -->
        <div style="background: #f8f9fa; border-radius: 15px; padding: 20px; margin: 20px 0; border: 2px dashed #8B0000;">
            <h3 style="color: #8B0000; font-size: 16px; font-weight: 600; margin-bottom: 15px;">üìä Database Management</h3>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button onclick="exportAttendance()" style="background: #28a745; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    üì• Export Attendance Data
                </button>
                <button onclick="importAttendance()" style="background: #ffc107; color: #333; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    üì§ Import Attendance Data
                </button>
                <button onclick="exportStudents()" style="background: #17a2b8; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    üë• Export Student List
                </button>
            </div>
            <p style="color: #666; font-size: 12px; margin-top: 10px;">
                <small>‚ö†Ô∏è Import accepts CSV files with headers: Date, StudentID, StudentName, Period, Status, Faculty, Course</small>
            </p>
        </div>

        <div class="table-container" style="background: white; border-radius: 15px; padding: 20px;">
            <div class="table-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #8B0000; padding-bottom: 10px;">
                <h3 style="color: #333; font-size: 18px;">Quick Actions</h3>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;">
                <button class="btn-primary" onclick="navigateTo('markAttendance')" style="padding: 15px;">‚úÖ Mark Attendance</button>
                <button class="btn-primary" onclick="navigateTo('departments')" style="padding: 15px;">üèõÔ∏è Departments</button>
                <button class="btn-primary" onclick="navigateTo('courses')" style="padding: 15px;">üìö All Courses</button>
                <button class="btn-primary" onclick="navigateTo('students')" style="padding: 15px;">üë• Students List</button>
                <button class="btn-primary" onclick="navigateTo('faculty')" style="padding: 15px;">üë®‚Äçüè´ Faculty List</button>
                <button class="btn-primary" onclick="testConnection()" style="padding: 15px; background: #17a2b8;">üîå Test Netlify</button>
            </div>
        </div>
    `;
}

        // ==================== MARK ATTENDANCE PAGE ====================
        async function showMarkAttendance() {
            const content = document.getElementById('mainContent');
            const today = new Date().toISOString().split('T')[0];

            if (studentsList.length === 0) {
                await loadStudentsFromSheet();
            }

            if (studentsList.length === 0) {
                content.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <h3 style="color: #8B0000;">No Students Found</h3>
                        <p>Please add students to the Students sheet in Google Sheets.</p>
                        <button class="btn-primary" onclick="testConnection()" style="margin-top: 20px; padding: 10px 20px; background:#28a745;">
                            üîå Test Netlify
                        </button>
                    </div>
                `;
                return;
            }

            content.innerHTML = `
                <div class="mark-attendance-page">
                    <h2 style="color: #8B0000; margin-bottom: 20px;">Mark Attendance</h2>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                        <p>Date: ${new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        <p>Total Students: ${studentsList.length}</p>
                    </div>
                    
                    <div class="period-selector">
                        <h3>Select Period</h3>
                        <div class="period-grid">
                            ${[1, 2, 3, 4, 5].map(period => `
                                <div class="period-card ${selectedPeriod === period ? 'selected' : ''}" onclick="selectPeriod(${period})">
                                    <div class="period-number">Period ${period}</div>
                                    <div class="period-time">${getPeriodTime(period)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="course-selector">
                        <h3>Select Course</h3>
                        <select class="course-select" onchange="selectCourse(this.value)">
                            <option value="">Choose a course...</option>
                            ${courses.map(course => `
                                <option value="${course.id}" ${selectedCourse == course.id ? 'selected' : ''}>${course.code} - ${course.name}</option>
                            `).join('')}
                        </select>
                    </div>

                    ${selectedCourse ? `
                        <div class="mark-all-section">
                            <h3>Quick Mark All</h3>
                            <div class="mark-all-buttons">
                                <button class="mark-all-btn present" onclick="markAllStudents('present')">‚úÖ All Present</button>
                                <button class="mark-all-btn absent" onclick="markAllStudents('absent')">‚ùå All Absent</button>
                                <button class="mark-all-btn late" onclick="markAllStudents('late')">‚è∞ All Late</button>
                                <button class="mark-all-btn letoff" onclick="markAllStudents('letoff')">‚òë All Let-off</button>
                            </div>
                        </div>

                        <div class="student-list">
                            <div class="student-list-header">
                                <h3>Students (${studentsList.length})</h3>
                                <input type="text" placeholder="Search student..." style="padding: 8px; border: 1px solid #ddd; border-radius: 5px;" onkeyup="searchStudents(this.value)">
                            </div>
                            <div id="studentListContainer">
                                ${studentsList.map(student => {
                                    const key = `${student.reg}_${today}_${selectedPeriod}`;
                                    const status = attendanceData[key] || 'unmarked';
                                    return `
                                        <div class="student-list-item" id="student-${student.reg}">
                                            <div class="student-info">
                                                <h4>${student.name}</h4>
                                                <p>${student.reg} | Batch: ${student.batch || 'A'} | Year: ${student.year || '1st'}</p>
                                            </div>
                                            <div class="student-status">
                                                <div class="status-option present ${status === 'present' ? 'active' : ''}" onclick="setStudentStatus('${student.reg}', 'present')">‚úì</div>
                                                <div class="status-option absent ${status === 'absent' ? 'active' : ''}" onclick="setStudentStatus('${student.reg}', 'absent')">‚úó</div>
                                                <div class="status-option late ${status === 'late' ? 'active' : ''}" onclick="setStudentStatus('${student.reg}', 'late')">‚è∞</div>
                                                <div class="status-option letoff ${status === 'letoff' ? 'active' : ''}" onclick="setStudentStatus('${student.reg}', 'letoff')">‚òë</div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>

                        <div class="submit-attendance">
                            <button class="cancel-btn" onclick="resetAttendance()">Reset</button>
                            <button class="submit-btn" onclick="submitAttendance()">Submit Attendance</button>
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 50px; color: #666;">
                            Please select a course to start marking attendance
                        </div>
                    `}
                </div>
            `;
        }

        function searchStudents(query) {
            const items = document.querySelectorAll('.student-list-item');
            const q = query.toLowerCase();
            items.forEach(item => {
                const name = item.querySelector('.student-info h4').textContent.toLowerCase();
                const reg = item.querySelector('.student-info p').textContent;
                item.style.display = (name.includes(q) || reg.includes(q)) ? 'flex' : 'none';
            });
        }

        function selectPeriod(period) {
            selectedPeriod = period;
            showMarkAttendance();
        }

        function selectCourse(courseId) {
            selectedCourse = parseInt(courseId);
            showMarkAttendance();
        }

        function setStudentStatus(regNo, status) {
            if (!selectedCourse) return;
            const today = new Date().toISOString().split('T')[0];
            const key = `${regNo}_${today}_${selectedPeriod}`;
            attendanceData[key] = status;
            
            const div = document.getElementById(`student-${regNo}`);
            if (div) {
                div.querySelectorAll('.status-option').forEach(opt => opt.classList.remove('active'));
                div.querySelector(`.status-option.${status}`).classList.add('active');
            }
        }

        function markAllStudents(status) {
            if (!selectedCourse) return;
            const today = new Date().toISOString().split('T')[0];
            
            studentsList.forEach(student => {
                const key = `${student.reg}_${today}_${selectedPeriod}`;
                attendanceData[key] = status;
                const div = document.getElementById(`student-${student.reg}`);
                if (div) {
                    div.querySelectorAll('.status-option').forEach(opt => opt.classList.remove('active'));
                    div.querySelector(`.status-option.${status}`).classList.add('active');
                }
            });
        }

        function resetAttendance() {
            if (!selectedCourse) return;
            const today = new Date().toISOString().split('T')[0];
            
            studentsList.forEach(student => {
                delete attendanceData[`${student.reg}_${today}_${selectedPeriod}`];
            });
            showMarkAttendance();
        }

        async function submitAttendance() {
            if (!selectedCourse) return;
            
            const today = new Date().toISOString().split('T')[0];
            const courseObj = courses.find(c => c.id == selectedCourse);
            
            const records = [];
            studentsList.forEach(student => {
                const key = `${student.reg}_${today}_${selectedPeriod}`;
                const status = attendanceData[key];
                if (status && status !== 'unmarked') {
                    records.push({
                        date: today,
                        studentId: student.reg,
                        studentName: student.name,
                        period: selectedPeriod,
                        status: status,
                        faculty: currentUser.name,
                        course: courseObj ? `${courseObj.code}-${courseObj.name}` : 'Course'
                    });
                }
            });
            
            if (records.length === 0) {
                showNotification('No attendance marked!', 'info');
                return;
            }
            
            await saveAttendanceToSheet(records);
            
            setTimeout(async () => {
                await loadAttendanceFromSheet();
            }, 1000);
            
            selectedCourse = null;
            showMarkAttendance();
        }

        // ==================== ATTENDANCE PAGE (FULL IMPLEMENTATION) ====================
        function showAttendance() {
            const content = document.getElementById('mainContent');
            
            content.innerHTML = `
                <div class="attendance-page">
                    <div class="attendance-tabs">
                        <button class="attendance-tab active" onclick="showAttendanceCourse()">Course</button>
                        <button class="attendance-tab" onclick="showAttendanceHourly()">Hourly</button>
                        <button class="attendance-tab" onclick="showAttendanceTermly()">Termly</button>
                    </div>
                    <div id="attendanceContent">
                        ${getAttendanceCourseHTML()}
                    </div>
                </div>
            `;
        }

        function getAttendanceCourseHTML() {
            const studentId = currentUser.reg;
            
            const allRecords = Object.keys(attendanceData)
                .filter(key => key.startsWith(studentId) && !key.includes('_'));
            
            const totalClasses = allRecords.length;
            const presentClasses = allRecords.filter(key => attendanceData[key] === 'present').length;
            const attendancePercentage = totalClasses > 0 ? Math.round((presentClasses / totalClasses) * 100) : 0;
            
            return `
                <div class="course-list">
                    <div class="course-item">
                        <div class="course-header">
                            <h3>Overall Attendance</h3>
                        </div>
                        <div class="course-stats">
                            <span>Total Classes: ${totalClasses}</span>
                            <span>Attended: ${presentClasses}</span>
                            <span>Percentage: ${attendancePercentage}%</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function showAttendanceCourse() {
            document.querySelectorAll('.attendance-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('attendanceContent').innerHTML = getAttendanceCourseHTML();
        }

        function showAttendanceHourly() {
            document.querySelectorAll('.attendance-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            const studentId = currentUser.reg;
            
            const months = [
                { name: 'November', year: 2025, monthNum: 11, days: 30 },
                { name: 'December', year: 2025, monthNum: 12, days: 31 },
                { name: 'January', year: 2026, monthNum: 1, days: 31 },
                { name: 'February', year: 2026, monthNum: 2, days: 28 }
            ];
            
            const currentMonth = months.find(m => m.name === selectedMonth) || months[0];
            
            const days = [];
            for (let d = 1; d <= currentMonth.days; d++) {
                const date = new Date(currentMonth.year, currentMonth.monthNum - 1, d);
                const weekday = date.toLocaleDateString('en-US', { weekday: 'short' }).substring(0, 3);
                days.push({ 
                    day: d, 
                    weekday: weekday, 
                    date: `${currentMonth.year}-${currentMonth.monthNum.toString().padStart(2, '0')}-${d.toString().padStart(2, '0')}` 
                });
            }
            
            const html = `
                <div>
                    <div class="month-grid">
                        ${months.map(month => `
                            <button class="month-btn ${selectedMonth === month.name ? 'active' : ''}" onclick="selectMonth('${month.name}')">
                                ${month.name}
                            </button>
                        `).join('')}
                    </div>
                    <table class="attendance-table">
                        <thead>
                            <tr>
                                <th>Day</th>
                                <th>H1</th>
                                <th>H2</th>
                                <th>H3</th>
                                <th>H4</th>
                                <th>H5</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${days.map(day => {
                                return `
                                    <tr>
                                        <td>${day.day}-${day.weekday}</td>
                                        ${[1, 2, 3, 4, 5].map(hour => {
                                            const key = `${studentId}_${day.date}_${hour}`;
                                            const status = attendanceData[key] || 'unmarked';
                                            return `<td class="status-${status}">${getStatusSymbol(status)}</td>`;
                                        }).join('')}
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                    <div class="status-buttons">
                        <span class="status-btn present">‚úÖ Present</span>
                        <span class="status-btn absent">‚ùå Absent</span>
                        <span class="status-btn late">‚è∞ Late</span>
                        <span class="status-btn letoff">‚òë Let-off</span>
                        <span class="status-btn unmarked">‚óª Unmarked</span>
                    </div>
                </div>
            `;
            
            document.getElementById('attendanceContent').innerHTML = html;
        }

        function selectMonth(month) {
            selectedMonth = month;
            showAttendanceHourly();
        }

        function showAttendanceTermly() {
            document.querySelectorAll('.attendance-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            const studentId = currentUser.reg;
            
            const months = [
                { name: 'Nov', days: 30, year: 2025, monthNum: 11 },
                { name: 'Dec', days: 31, year: 2025, monthNum: 12 },
                { name: 'Jan', days: 31, year: 2026, monthNum: 1 }
            ];
            
            let totalAttended = 0;
            let totalClasses = 0;
            
            const monthData = months.map((month, index) => {
                let attended = 0;
                let total = 0;
                
                for (let day = 1; day <= month.days; day++) {
                    const date = `${month.year}-${month.monthNum.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                    for (let hour = 1; hour <= 5; hour++) {
                        const key = `${studentId}_${date}_${hour}`;
                        if (attendanceData[key]) {
                            total++;
                            totalClasses++;
                            if (attendanceData[key] === 'present') {
                                attended++;
                                totalAttended++;
                            }
                        }
                    }
                }
                
                const percent = total > 0 ? Math.round((attended / total) * 100) : 0;
                
                return {
                    sl: index + 1,
                    year: month.year,
                    month: month.name,
                    attended: attended,
                    total: total,
                    percent: percent
                };
            });
            
            const overallPercent = totalClasses > 0 ? Math.round((totalAttended / totalClasses) * 100) : 0;
            
            const html = `
                <div class="term-stats">
                    <div class="term-header">
                        <h3>Semester-6</h3>
                        <span>${overallPercent}%</span>
                    </div>
                    <div class="term-period">Term<br>19-11-2025 To 15-04-2026</div>
                    <table class="term-table">
                        <thead>
                            <tr>
                                <th>SI</th>
                                <th>Year</th>
                                <th>Month</th>
                                <th>Attendance</th>
                                <th>Total</th>
                                <th>%</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${monthData.map(m => `
                                <tr>
                                    <td>${m.sl}</td>
                                    <td>${m.year}</td>
                                    <td>${m.month}</td>
                                    <td>${m.attended}</td>
                                    <td>${m.total}</td>
                                    <td>${m.percent}</td>
                                </tr>
                            `).join('')}
                            <tr>
                                <td colspan="3"><strong>Total</strong></td>
                                <td><strong>${totalAttended}</strong></td>
                                <td><strong>${totalClasses}</strong></td>
                                <td><strong>${overallPercent}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('attendanceContent').innerHTML = html;
        }

        function getStatusSymbol(status) {
            switch(status) {
                case 'present': return '‚úÖ';
                case 'absent': return '‚ùå';
                case 'late': return '‚è∞';
                case 'letoff': return '‚òë';
                default: return '‚óª';
            }
        }

        // ==================== PROFILE PAGE ====================
        function showProfile() {
            const content = document.getElementById('mainContent');
            
            content.innerHTML = `
                <div class="account-page" style="background: white; border-radius: 20px; padding: 20px;">
                    <div class="account-header" style="text-align: center; margin-bottom: 30px;">
                        <div class="profile-avatar" style="width: 80px; height: 80px; background: #8B0000; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; margin: 0 auto 15px;">
                            ${currentUser.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase()}
                        </div>
                        <h2 style="color: #333; font-size: 22px;">${currentUser.name}</h2>
                        <p style="color: #666;">${currentUser.role === 'student' ? 'Register No: ' + currentUser.reg : 'Staff Member'}</p>
                        ${currentUser.role === 'student' ? `<p style="color: #8B0000;">Batch: ${currentUser.batch} | Year: ${currentUser.semester}</p>` : ''}
                    </div>

                    <button class="logout-btn-account" onclick="logout()" style="width: 100%; padding: 15px; background: #dc3545; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer;">Logout</button>
                </div>
            `;
        }

        // ==================== DEPARTMENTS PAGE ====================
        function showDepartments() {
            const departments = [
                { name: 'Computer Science', hod: 'Dr. CS HOD', faculty: 15, courses: 8 },
                { name: 'Mathematics', hod: 'Dr. Maths HOD', faculty: 12, courses: 6 },
                { name: 'Physics', hod: 'Dr. Physics HOD', faculty: 10, courses: 5 },
                { name: 'Chemistry', hod: 'Dr. Chemistry HOD', faculty: 11, courses: 5 },
                { name: 'English', hod: 'Dr. English HOD', faculty: 9, courses: 4 },
                { name: 'Commerce', hod: 'Dr. Commerce HOD', faculty: 14, courses: 7 }
            ];
            
            let html = `
                <div style="background: white; border-radius: 20px; padding: 20px;">
                    <h2 style="color: #8B0000; margin-bottom: 20px;">Academic Departments</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            `;
            
            departments.forEach(dept => {
                html += `
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; border-left: 4px solid #8B0000;">
                        <h3 style="color: #8B0000; margin-bottom: 10px;">${dept.name}</h3>
                        <p style="color: #666; margin-bottom: 5px;">HOD: ${dept.hod}</p>
                        <p style="color: #666; margin-bottom: 5px;">Faculty: ${dept.faculty}</p>
                        <p style="color: #666;">Courses: ${dept.courses}</p>
                    </div>
                `;
            });
            
            html += `</div></div>`;
            document.getElementById('mainContent').innerHTML = html;
        }

        // ==================== ALL COURSES PAGE ====================
        function showAllCourses() {
            let html = `
                <div style="background: white; border-radius: 20px; padding: 20px;">
                    <h2 style="color: #8B0000; margin-bottom: 20px;">All Courses</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            `;
            
            courses.forEach(course => {
                html += `
                    <div style="background: #f8f9fa; border-radius: 10px; padding: 20px; border-left: 4px solid #8B0000;">
                        <h3 style="color: #333; margin-bottom: 5px;">${course.name}</h3>
                        <p style="color: #8B0000; font-weight: 600; margin-bottom: 5px;">${course.code}</p>
                        <p style="color: #666; margin-bottom: 5px;">Faculty: ${course.faculty}</p>
                        <p style="color: #666;">Total Hours: ${course.totalHours}</p>
                    </div>
                `;
            });
            
            html += `</div></div>`;
            document.getElementById('mainContent').innerHTML = html;
        }

        // ==================== STUDENTS LIST PAGE ====================
        function showStudentsList() {
            if (studentsList.length === 0) {
                document.getElementById('mainContent').innerHTML = `
                    <div style="background: white; border-radius: 20px; padding: 20px; text-align: center;">
                        <h2 style="color: #8B0000; margin-bottom: 20px;">Students List</h2>
                        <p>No students found.</p>
                        <button onclick="testConnection()" class="btn-primary" style="margin-top: 20px; padding: 10px 20px; background:#28a745;">
                            üîå Test Connection
                        </button>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div style="background: white; border-radius: 20px; padding: 20px;">
                    <h2 style="color: #8B0000; margin-bottom: 20px;">Students List (${studentsList.length})</h2>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f8f9fa;">
                                    <th style="padding: 12px; text-align: left;">S.No</th>
                                    <th style="padding: 12px; text-align: left;">Register No</th>
                                    <th style="padding: 12px; text-align: left;">Name</th>
                                    <th style="padding: 12px; text-align: left;">Batch</th>
                                    <th style="padding: 12px; text-align: left;">Year</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            studentsList.forEach((student, index) => {
                html += `
                    <tr style="border-bottom: 1px solid #f0f0f0;">
                        <td style="padding: 10px;">${index + 1}</td>
                        <td style="padding: 10px;">${student.reg}</td>
                        <td style="padding: 10px;">${student.name}</td>
                        <td style="padding: 10px;">${student.batch || 'A'}</td>
                        <td style="padding: 10px;">${student.year || '1st'}</td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div></div>`;
            document.getElementById('mainContent').innerHTML = html;
        }

        // ==================== FACULTY LIST PAGE ====================
        function showFacultyList() {
            let html = `
                <div style="background: white; border-radius: 20px; padding: 20px;">
                    <h2 style="color: #8B0000; margin-bottom: 20px;">Faculty List (${staffMembers.length})</h2>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f8f9fa;">
                                    <th style="padding: 12px; text-align: left;">S.No</th>
                                    <th style="padding: 12px; text-align: left;">Name</th>
                                    <th style="padding: 12px; text-align: left;">Department</th>
                                    <th style="padding: 12px; text-align: left;">Designation</th>
                                    <th style="padding: 12px; text-align: left;">Email</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            staffMembers.forEach((staff, index) => {
                html += `
                    <tr style="border-bottom: 1px solid #f0f0f0;">
                        <td style="padding: 10px;">${index + 1}</td>
                        <td style="padding: 10px;">${staff.name}</td>
                        <td style="padding: 10px;">${staff.department}</td>
                        <td style="padding: 10px;">${staff.designation}</td>
                        <td style="padding: 10px;">${staff.email}</td>
                    </tr>
                `;
            });
            
            html += `</tbody></table></div></div>`;
            document.getElementById('mainContent').innerHTML = html;
        }

        // ==================== PLACEHOLDER PAGES ====================
        function showPlaceholder(page) {
            document.getElementById('mainContent').innerHTML = `<div style="background: white; border-radius: 20px; padding: 20px;"><h2 style="color: #8B0000; text-transform: capitalize;">${page}</h2><p>Coming soon!</p></div>`;
        }

        // ==================== NOTIFICATION ====================
        function showNotification(message, type) {
            const n = document.getElementById('notification');
            document.getElementById('notificationIcon').textContent = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            document.getElementById('notificationMessage').textContent = message;
            n.className = `notification ${type} show`;
            setTimeout(() => n.classList.remove('show'), 3000);
        }

        // ==================== LOGOUT ====================
        function logout() {
            clearSession();
            currentUser = null;
            selectedCourse = null;
            selectedPeriod = 1;
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('dashboard').classList.remove('active');
            showNotification('Logged out', 'info');
        }

        // ==================== INITIALIZE ====================
        document.addEventListener('DOMContentLoaded', async () => {
            setRole('student');
            await loadStudentsFromSheet();
            await loadAttendanceFromSheet();
            loadSession();
            startAutoRefresh();
            updateRecentItems();
        });
    </script>
</body>
</html>